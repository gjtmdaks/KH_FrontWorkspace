<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body style="margin:0; font-family:consolas; line-height:85%; letter-spacing:2px; font-size:10px;">

    <video id="video" src="./[Alstroemeria Records]Bad Apple!! feat.nomico(Shadow Animation Version)[ACVS.008_Tr.00].mp4"
    style="
         position: fixed;
         bottom: 0;
         right: 0;
         width: 1px;
         height: 1px;
         opacity: 0.01;
         pointer-events: none;
       " autoplay loop muted></video>
    <canvas id="canvas" width="160" height="120" style="display:none"></canvas>
    <pre id="output"></pre>

    <script>
        const video = document.getElementById('video')
        const canvas = document.getElementById('canvas')
        const ctx = canvas.getContext('2d')
        const output = document.getElementById('output')

        const ascii = "@%#*+=-:. "
        const step = 4
        const w = canvas.width
        const h = canvas.height

        function render() {
            ctx.drawImage(video, 0, 0, w, h)
            const data = ctx.getImageData(0, 0, w, h).data

            let result = ""

            for (let y = 0; y < h; y += step) {
                for (let x = 0; x < w; x += step) {
                    const i = (y * w + x) * 4
                    const gray = 0.299 * data[i] + 0.587 * data[i + 1] + 0.114 * data[i + 2]
                    const idx = Math.floor(gray / 255 * (ascii.length - 1))
                    result += ascii[idx]
                }
                result += "\n"
            }

            output.innerText = result
            requestAnimationFrame(render)
        }

        video.addEventListener('play', render)
    </script>
</body>

</html>